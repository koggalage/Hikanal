<html>
  <head>
    
  </head>
<body>
  
  <div id="map-canvas"></div>
  <div id="map-canvas2"></div>
</body>

<style>
html, body, #map-canvas {
    height: 100%;
    width: 70%;
    margin: 0px;
    padding: 0px
}
</style>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDxJt45HSxnhUn26cibrRrQin578_9T-Yg"></script>

<script>
  
function initialize() {     
var myLatlng;    
var mapOptions;

myLatlng = new google.maps.LatLng(7.884472, 80.850632);

    mapOptions = {
      zoom: 8,
      center: myLatlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    var map = new google.maps.Map(
      document.getElementById("map-canvas"), mapOptions);

    google.maps.event.addListenerOnce(map, 'idle', function() {
      drawRectangle(map);
    });

    function drawRectangle(map) {
      var bounds = map.getBounds();
      var southWest = bounds.getSouthWest();
      var northEast = bounds.getNorthEast();


      var numberOfParts = 6;

      var tileWidth = (northEast.lng() - southWest.lng()) / numberOfParts;
      var tileHeight = (northEast.lat() - southWest.lat()) / numberOfParts;

      console.log("northEast.lng()", northEast.lng());
      console.log("southWest.lng()", southWest.lng());
      console.log("tileWidth", tileWidth);
      console.log("tileHeight", tileHeight);
      //console.log("northEast", northEast);

      for (var x = 0; x < numberOfParts; x++) {
        for (var y = 0; y < numberOfParts; y++) {
          var areaBounds = {
            north: southWest.lat() + (tileHeight * (y+1)),
            south: southWest.lat() + (tileHeight * y),
            east: southWest.lng() + (tileWidth * (x+1)),
            west: southWest.lng() + (tileWidth * x)
          };

          console.log("areaBounds.north", areaBounds.north);
          // console.log("southWest.lng()", southWest.lng());
          // console.log("tileWidth", tileWidth);
          // console.log("tileHeight", tileHeight);

          var area = new google.maps.Rectangle({
            strokeColor: '#FF0000',
            //strokeOpacity: 0.8,
            strokeWeight: 2,
            //fillColor: '#FF0000',
            //fillOpacity: 0.35,
            map: map,
            bounds: areaBounds
          });
          var centerMark = new google.maps.Marker({
          position: area.getBounds().getCenter(),
          map: map,
          area: areaBounds,
          title: area.getBounds().getCenter().toUrlValue(6)
          });
          google.maps.event.addListener(centerMark, 'click', function(evt) {
            // console.log(this.position.lat());
            // console.log(this.position.lng());

            initMap(this.position.lat(), this.position.lng());
            // map.fitBounds(this.area);
            // google.maps.event.addListenerOnce(map, 'bounds_changed', function() {
            //   map.setZoom(map.getZoom()+1);
            // })
              
          });
        }
      }
    }   
  }

      var rectangle;
      var map;
      var infoWindow;
      // var centerLat = 7.734472;
      // var centerLng = 80.850632;

      function initMap(centerLat, centerLng) {
        console.log(centerLat);
        console.log(centerLng);
        map = new google.maps.Map(document.getElementById('map-canvas'), {
          center: {lat: centerLat, lng: centerLng},
          zoom: 10
        });

        var bounds = {
          north: centerLat - 0.1,
          south: centerLat  - 0.3,
          east: centerLng  - 0.1,
          west: centerLng  - 0.3
        };

        // Define the rectangle and set its editable property to true.
        rectangle = new google.maps.Rectangle({
          bounds: bounds,
          editable: true,
          draggable: true
        });

        rectangle.setMap(map);

        // Add an event listener on the rectangle.
        rectangle.addListener('bounds_changed', showNewRect);

        // Define an info window on the map.
        infoWindow = new google.maps.InfoWindow();
      }
      // Show the new coordinates for the rectangle in an info window.

      /** @this {google.maps.Rectangle} */
      function showNewRect(event) {
        var ne = rectangle.getBounds().getNorthEast();
        var sw = rectangle.getBounds().getSouthWest();

        var contentString = '<b>Rectangle moved.</b><br>' +
            'New north-east corner: ' + ne.lat() + ', ' + ne.lng() + '<br>' +
            'New south-west corner: ' + sw.lat() + ', ' + sw.lng();

        // Set the info window's content and position.
        infoWindow.setContent(contentString);
        infoWindow.setPosition(ne);

        infoWindow.open(map);
      }   

google.maps.event.addDomListener(window, "load", initialize); 
</script>


</html>
